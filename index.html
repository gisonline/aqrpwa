<!DOCTYPE html>
<html lang="fa" dir="rtl">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no">
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="theme-color" content="#000000">
        <meta name="description" content="An offline capable map viewer with GPS integration">
        <meta name="author" content="wapco">
        <title>آستان قدس رضوی</title>
        <link rel="manifest" href="manifest.json">
        <link rel="apple-touch-icon" href="assets/img/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="assets/img/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="assets/img/favicon-16x16.png">
        <link rel="stylesheet" href="assets/vendor/leaflet-1.9.4/leaflet.css">
        <link rel="stylesheet" href="assets/vendor/leaflet-locatecontrol-0.79.0/L.Control.Locate.min.css">
        <!--<link rel="stylesheet" href="assets/vendor/leaflet-measure/leaflet-measure.css">-->
        <link rel="stylesheet" href="assets/vendor/leaflet-measure/Leaflet.PolylineMeasure.css" />
        <link rel="stylesheet" href="assets/vendor/leaflet-measure/leaflet.measure.css" />
        <link rel="stylesheet" href="assets/vendor/icomoon/style.css">
        <link rel="stylesheet" href="assets/css/app.css">
    </head>
    <body>
        <main id="map">
            <div class="progress" id="progress-bar">
                <div class="indeterminate"></div>
            </div>
        </main>
        <script src="assets/js/config.js"></script>
        <script src="assets/vendor/sqljs-1.8.0/sql-wasm.js"></script>
        <script src="assets/vendor/localForage-1.10.0/localforage.min.js"></script>
        <script src="assets/vendor/leaflet-1.9.4/leaflet.js"></script>
        <script src="assets/vendor/leaflet-locatecontrol-0.79.0/L.Control.Locate.js"></script>
        <script src="assets/vendor/leaflet-mbtiles/Leaflet.TileLayer.MBTiles.js"></script>
        <!--<script src="assets/vendor/leaflet-measure/leaflet-measure.js"></script>-->
        <script src="assets/vendor/leaflet-measure/Leaflet.PolylineMeasure.js"></script>
        <script src="assets/vendor/leaflet-measure/leaflet.measure.js"></script>
        <script src="assets/vendor/csv2geojson-5.1.1/csv2geojson.min.js"></script>
        <script src="assets/vendor/togeojson-0.16.0/togeojson.min.js"></script>
        <script src="assets/js/app.js"></script>
        <script>
//            if ("serviceWorker" in navigator) {
//                navigator.serviceWorker.register("service-worker.js");
//            }
            import {Workbox} from 'https://storage.googleapis.com/workbox-cdn/releases/6.5.4/workbox-window.prod.mjs';

            if ('serviceWorker' in navigator) {
                const wb = new Workbox('/sw.js');
                let registration;

                const showSkipWaitingPrompt = async (event) => {
                    // Assuming the user accepted the update, set up a listener
                    // that will reload the page as soon as the previously waiting
                    // service worker has taken control.
                    wb.addEventListener('controlling', () => {
                        // At this point, reloading will ensure that the current
                        // tab is loaded under the control of the new service worker.
                        // Depending on your web app, you may want to auto-save or
                        // persist transient state before triggering the reload.
                        window.location.reload();
                    });

                    // When `event.wasWaitingBeforeRegister` is true, a previously
                    // updated service worker is still waiting.
                    // You may want to customize the UI prompt accordingly.

                    // This code assumes your app has a promptForUpdate() method,
                    // which returns true if the user wants to update.
                    // Implementing this is app-specific; some examples are:
                    // https://open-ui.org/components/alert.research or
                    // https://open-ui.org/components/toast.research
                    const updateAccepted = await promptForUpdate();

                    if (updateAccepted) {
                        wb.messageSkipWaiting();
                    }
                };

                // Add an event listener to detect when the registered
                // service worker has installed but is waiting to activate.
                wb.addEventListener('waiting', (event) => {
                    showSkipWaitingPrompt(event);
                });

                wb.register();
            }
        </script>
        <noscript>This website requires JavaScript!</noscript>
    </body>
</html>